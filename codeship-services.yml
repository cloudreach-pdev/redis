base: &base
  image: cloudreach/deploy:0.6.0
  volumes:
  - .:/mnt/deploy
  cached: true

redis:
  build:
    image: cloudreach/redis
    dockerfile_path: Dockerfile
  cached: true

deploy_dev:
  <<: *base
  links:
  - vault_dev:vault
  environment:
  - ENVIRONMENT_ID=dev
  - AWS_DEFAULT_REGION=eu-west-1
  encrypted_env_file: deploy-development.env.encrypted

deploy_demo:
  <<: *base
  links:
  - vault_demo:vault
  environment:
  - ENVIRONMENT_ID=demo
  - AWS_DEFAULT_REGION=eu-central-1
  encrypted_env_file: deploy-demo.env.encrypted

deploy_prod:
  <<: *base
  links:
  - vault_prod:vault
  environment:
  - ENVIRONMENT_ID=prod
  - AWS_DEFAULT_REGION=eu-west-1
  encrypted_env_file: deploy-production.env.encrypted

vault_dev:
  image: cloudreach/conductor-secrets:dev
  cached: false
  cap_add:
  - IPC_LOCK

vault_demo:
  image: cloudreach/conductor-secrets:demo
  cached: false
  cap_add:
  - IPC_LOCK

vault_prod:
  image: cloudreach/conductor-secrets:prod
  cached: false
  cap_add:
  - IPC_LOCK
